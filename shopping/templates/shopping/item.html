{% extends 'shopping/base.html' %}

{% load static %}
{% load l10n %}

{% block title %} {{ item.name }} - Shop {% endblock %}

{% block content %}
<!-- ANDY WORKED ON THIS ONE -->

<a class="btn btn-primary m-2" href="{% url 'listings' %}">Back to listings...</a> <!-- make this cute later -->

<!-- MODALS -->
<!-- edit -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editItemModal" aria-hidden="true"> <!-- USES add_item VIEW FUNCTION; the enctype allows this form WITHOUT using the django form!-->
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">Edit Item</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Add Item Form -->
        <form method="POST" id="editItem" action=" url 'edit-item' " enctype='multipart/form-data'> <!-- THIS TRIGGERS THE add_item VIEW FUNCTION-->
            {% csrf_token %}
            <!--{{ form }}-->
            <div class="form-group">
              <label for="editPhoto" class="form-label">Upload a different photo</label>
              <input type="file" class="form-control" accept="image/png, image/jpeg, image/jpg" onchange="checkFile(this)" id="itemImage" name="image" required>              
            </div>              
            <div class="form-group">
                <label for="editName">Item Name:</label>
                <input type="text" placeholder="What your item is (Max 50 characters.)" aria-placeholder="What your item is (Max 50 characters.)" class="form-control" id="itemName" name="name" required>
            </div>
            <div class="form-group">
                <label for="editPrice">Price:</label>
                <input type="number" class="itemPrice form-control" id="itemPrice" name="price" step=".01" min="0" maxlength="10" required>
            </div>
            <div class="form-group">
                <label for="editDescription">Description:</label>
                <textarea class="form-control" placeholder="Describe your item here... (Max 250 characters.)" aria-placeholder="Describe your item here... (Max 250 characters.)" id="itemDescription" name="description" style="height: 100px" maxlength ="250"></textarea>
            </div>
            <div class="modal-footer">
              <button type="submit" name="edit_item" class="btn btn-outline-info">Post</button>
            <!-- Footer, put buttons here-->
            </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- delete confirmation -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
  <div class="modal-header">
    <h1 class="modal-title fs-5" id="deleteModalLabel">Are you sure you want to delete this item?</h1>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
  </div>
  <div class="modal-body">
    <p>This action cannot be undone.</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
    <form method="POST" action="{% url 'delete-item' item.pk %}">
      {% csrf_token %}
      <button type="submit" class="btn btn-danger">Delete</button>
    </form>
    <!-- COME BACK AND FIX THIS -->
  </div>
    </div>
  </div>
</div>

<!-- GENERAL ITEM INFO DISPLAY -->
<div class="container">
  <div class="row">
    <div class="col-md-6">
      <img src="{{ item.image.url }}" class="img-thumbnail rounded-0" style="min-height: 80%;" alt="Image of {{item.name}}">
    </div>
    <div class="col-md-6">
      <h2>{{ item.name }}</h2>
      <h4 class="itemPrice">${{ item.price|localize }}</h4>
      <p><a class="badge text-bg-secondary" href="">@{{ item.user }}</a></p> <!-- insert link to profiles here -->
      <p> {{ item.description }} <br> <small> Posted {{ item.date_posted }} </small></p>
      <form action="url 'add_to_cart'" method="post">
        {% csrf_token %}
        <input type="hidden" name="item_id" value="{{ item.id }}">
        <button class="btn btn-primary">Add to cart</button>
      </form>
      {% if item.user == request.user %}
      <div class="user-options mt-1">
        <p> Item options: </p>
        <button data-bs-toggle="modal" data-bs-target="#editModal" class="btn btn-outline-primary">Edit</button>
        <button data-bs-toggle="modal" data-bs-target="#deleteModal" class="btn btn-outline-danger">Delete</button>
      </div>
      {% endif %}

      <!-- COMMENT SECTION -->
      <h3>Comments</h3>
      {% if item.comments.count == 0 %}
        <p>No comments yet.</p>
      {% else %}
        {% for comment in comments %}
          <div class="card p-1 rounded-0 mb-3" style="width: 18rem;">
            <div class="card-body">
              <p>{{ comment.comment }}</p> 
              <p><small>{{ comment.date_posted }}</small></p>
            </div>
          </div>
        {% endfor %}
      {% endif %}
      <form action="{% url 'add-comment' %}" method="POST" enctype='multipart/form-data'>
        {% csrf_token %}
        <div class="form-floating">
          <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea" name="comment"></textarea>
          <label for="floatingTextarea">Comments</label>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>
  </div>
</div>


{% endblock %}
